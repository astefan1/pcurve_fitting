---
title: "Evaluation of p-curve simulation results"
author: "Felix Sch√∂nbrodt & Angelika Stefan"
date: today
execute:
  cache: true
format: 
  html:
    code-fold: true
    embed-resources: true
---

Combine simulation results from all conditions into one big dataset

```{r}
#| include: false


library(fitPCurve)
library(rio)
library(dplyr)
library(ggplot2)

# The working directory should be the project root
# if quarto:render is called
if (!interactive()) {
  print("Switching working directory to project root")
  setwd("..")
}

# reference p-curves
pcurves <- import("simulations/reference-pcurves.csv")

# load the multiple DV simulation results:
simres_realistic <- import("simulations/sim-results/sim_realistic.csv")
simres_realistic$condition <- "multDV_realistic"
simres_worst <- import("simulations/sim-results/sim_worst.csv")
simres_worst$condition <- "multDV_worst"
simres_perfect <- import("simulations/sim-results/sim_perfect.csv")
simres_perfect$condition <- "multDV_perfect"
simres_H0 <- import("simulations/sim-results/sim_H0.csv")
simres_H0$condition <- "multDV_H0"

# load the optional stopping simulation results:
simres_optStop_worst <- import("simulations/sim-results/sim_optStop_worst.csv")
simres_optStop_worst$condition <- "optStop_worst"
simres_optStop_realistic <- import("simulations/sim-results/sim_optStop_realistic.csv")
simres_optStop_realistic$condition <- "optStop_realistic"

simres_multDV <- rbind(simres_realistic, simres_worst, simres_perfect, simres_H0)
simres_multDV$binsum <- rowSums(simres_multDV[, paste0("p", 1:5)])
stopifnot(all(simres_multDV$binsum |> round(6) == 1))
simres_multDV$type <- "multDV"

simres_optStop <- rbind(simres_optStop_realistic, simres_optStop_worst)
simres_optStop$binsum <- rowSums(simres_optStop[, paste0("p", 1:5)])
stopifnot(all(simres_optStop$binsum |> round(6) == 1))
simres_optStop$type <- "optStop"

# combine simulations from both p-hacking strategies (they have different parameter columns)
simres <- bind_rows(simres_multDV, simres_optStop)

save(simres, file="simulations/sim-results/simres_all.RData")
save(simres, file="simulations/ShinyApp/simres_all.RData")
```
